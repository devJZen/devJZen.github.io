---
layout: post
title: Chapter 2-2. 합의 (Consensus)
categories: web3
tags: [Blockchain]
---
> 블록과 블록간의 연결을 인정하는 것을 합의라고 하고 합의의 방식을 합의 매커니즘(또는 합의 알고리즘)이라고 일컫는다.

합의를 통해 네트워크에 전파된 수많은 트랜잭션들의 순서를 결정하고, 모든 노드가 동일한 블록 순서에 동의하도록 만드는 과정이다. 이를 통해 블록체인의 무결성과 일관성을 보장한다.

웹 개발에서의 트랜잭션과 블록체인 트랜잭션은 '누가 먼저 시도하느냐에 따라 시점의 차이가 생긴다'는 점에서 유사한 개념적 연결 고리를 가진다. 하지만 블록체인, 특히 이더리움은 이러한 **시점의 차이와 동시성 문제를 '합의'를 통해 해결**한다.

블록체인에서의 시점의 차이는 중앙 서버가 아니라 노드들의 **합의 과정**을 통해 해결된다. 누가 먼저 트랜잭션을 전파했는가도 중요하지만, 궁극적으로는 합의 알고리즘에 따라 블록에 포함되고 순서가 결정된다. 이렇게 한 번 확정된 트랜잭션은 ACID의 특성으로 블록체인 네트워크에 기록된다.

웹 개발의 트랜잭션이 특정 서버의 시간적 흐름에 따라 순서를 보장한다면, 블록체인의 트랜잭션은 **네트워크 전체가 합의한 시간적 흐름(블록체인)** 에 따라 순서를 보장한다는 점에서 근본적인 차이가 있다.

### 웹과 다른 분산 환경의 복잡성

-  **글로벌 시계의 부재:** 분산 시스템의 각 노드는 중앙 시계가 없으므로 완벽하게 동기화된 단일 시점을 공유하지 못한다. 이로 인해 **논리적 시계(Logical Clocks)** 나 **벡터 시계(Vector Clocks)** 와 같은 개념을 사용하여 이벤트의 **인과 관계(Causality)** 를 추론한다.
- **부분적 실패 및 네트워크 지연:** 노드 충돌, 네트워크 파티션, 메시지 손실이나 지연 등의 문제가 발생할 수 있다. 이러한 불확실성 속에서도 시스템 전체의 일관성을 유지해야 하는 과제가 있다.
- **이더리움의 문제 해결 방식:** 이더리움은 **작업 증명(PoW)** 을 거쳐서 **지분 증명(PoS)** 과 같은 **합의 알고리즘**을 통하여 분산된 노드들이 트랜잭션의 순서와 블록의 유효성에 대해 **단일하게 동의**하도록 만든다.

  - **결정론적 실행 환경(Deterministic Execution):** 이더리움의 **EVM(Ethereum Virtual Machine)** 은 **튜링 완전(Turing Complete)** 한 실행 환경을 제공하며, 동일한 초기 상태와 트랜잭션이 주어지면 **항상 동일한 결과**를 산출하도록 설계했다. 즉, 어떤 노드가 트랜잭션을 실행하더라도 결과는 예측 가능하고 일관적이다.
  - **가스(Gas) 메커니즘:** 스마트 컨트랙트가 튜링 완전하기 때문에 무한 루프나 과도한 자원 소모로 인한 서비스 거부(DoS) 공격의 위험이 있다. **가스**는 이러한 연산에 필요한 컴퓨팅 자원의 양을 측정하고 제한하는 '연료' 역할을 한다. 트랜잭션이 할당된 `gasLimit`을 초과하면 실행이 중단되고 모든 상태 변경이 되돌려지며 사용된 가스는 소각된다. 이는 무분별한 연산을 방지하여 네트워크의 안정성을 유지하는 핵심적인 제어 메커니즘이다.

합의는 시스템의 **상태 일관성**, **신뢰성**, **내결함성** 및 **분산된 통제**를 보장하여(트랜잭션의 ACID특성을 보장) 데이터 손상이나 영구적인 불일치를 방지한다.

---

## 1. 비트코인의 합의 매커니즘, 작업 증명 (PoW)

- **[비트코인](https://kr.beincrypto.com/learn-kr/bitcoin-futures/)**: 작업 증명을 구현한 최초의 암호화폐인 비트코인의 탈중앙화 네트워크는 채굴자에게 의존하여 블록체인을 보호한다.
- **[라이트코인](https://kr.beincrypto.com/learn-kr/litecoin-vs-bitcoin/)**: 비트코인의 포크인 라이트코인은 작업 증명을 사용하지만 거래 시간이 더 빠르기 때문에 일상적인 소규모 거래에 더 적합하다.

## 2. 이더리움의 합의 매커니즘, 지분 증명 (Pos)

- **이더리움**: 2022년 작업 증명에서 지분 증명으로 전환한 [이더리움](https://kr.beincrypto.com/learn-kr/ethereum-gas-fees-lowest/)은 현재 에너지 효율성과 확장성을 크게 향상시킨 지분 증명을 사용하고 있다.
- **카르다노**: 연구 중심 접근 방식으로 유명한 선도적인 지분 증명 블록체인인 [카르다노](https://kr.beincrypto.com/learn-kr/altchain/)는 스테이킹을 통해 보안과 지속 가능성을 강조한다.

## 3. 솔라나의 시간 관리 프로토콜, 역사 증명 (PoH)

- **솔라나**: 역사 증명이라는 시간 관리 프로토콜을 사용하여 모든 노드의 로컬 가상 시계를 동기화한다. PoH는 모든 메시지의 타임스탬프를 신뢰할 수 있도록 보장하고, 모든 노드가 현재 시간과 새로운 합의 라운드를 시작할 시점을 알고 있기 때문에 합의 프로토콜의 시간 초과를 방지할 수 있다.

> PoH는 합의 매커니즘, 시빌 저항 매커니즘과는 다른 접근이다.

## 4. Cosmos의 합의 알고리즘 (Tendermint)

참고 문서: [작업 증명과 지분 증명](https://kr.beincrypto.com/learn-kr/proof-of-work-vs-proof-of-stake/#h-%EC%9E%91%EC%97%85-%EC%A6%9D%EB%AA%85-pow-%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80%EC%9A%94), [PoH](https://ackee.xyz/solana/book/latest/chapter2/proof-of-history/)
