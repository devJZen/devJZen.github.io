---
layout: post
title: 솔라나 프로그래밍 모델
categories: web3
tags: [SolanaSchool7]
---
지금 포스팅은 SolanaSchool7에 대한 포스팅으로, 솔라나 스쿨 7기의 2강의 내용을 다룹니다.


솔라나 스쿨 7기 **[2강](https://youtu.be/wSRviwBG3zo)** 에서는 프로그래밍 모델을 위주로 학습한다.


## 프로그램 유래 주소 (Program Derived Addresses, PDA)

프로그램이 특정 데이터 계정을 통제하고 서명할 수 있도록 해주는 솔라나의 고유한 기능이다.
PDA가 무엇인지, 그리고 주소를 찾을 때 사용되는 범프(bump) 변수가 왜 중요한지에 대해 배운다.

### Keypair (엘리스-밥 이론)

> 오직 개인키를 가진 사람만이 서명할 수 있다.

일반적인 키페어는 사용자를 위한 것이다.  
공개키(자물쇠): 엘리스의 지갑 주소, 누구나 이 주소로 돈을 보낼 수 있다.  
개인키(열쇠): 엘리스만 아는 비밀 키, 엘리스가 자기 지갑에서 돈을 보낼 때 "이 돈을 보내는 건 내가 맞아"라고 증명하기 위해 거래에 서명하는 데 사용한다.

### 여기서 문제, 프로그램이 돈을 관리하게 하려면?

> 프로그램에 개인키를 저장해두면 누구나 프로그램 코드를 열어보고 개인키를 훔쳐서 자판기의 모든 돈을 빼갈 수 있다.

엘리스가 '솔라나 자판기'라는 프로그램을 사용한다고 하자. 이 자판기 프로그램은 사용자의 돈을 잠시 보관했다가, 물건과 함께 거스름돈을 내줘야 한다. 프로그램 자신이 소유한 계좌(지갑)이 필요하고, 그 계좌에서 돈을 내보내는 서명을 할 수 있어야 한다.

프로그램에 개인키를 저장해두면 최악의 상황에 자판기의 모든 돈을 빼갈 수 있는 상황이 연출된다. 이걸 위해서 솔라나는 **PDA(Program Derived Address)**라는 독특한 개념을 사용한다.

> [!info] PDA는 일반적인 공개키(주소)처럼 보이지만, 애초에 개인키가 존재하지 않는 특별한 주소다.  
> 일반적인 키페어는 타원곡선 암호학이라는 수학 규칙 위에서 만들어진다. PDA는 이 규칙을 일부러 살짝 비켜나게 주소를 생성한다.  
> 그래서 이 주소에 해당하는 개인키는 수학적으로 아예 존재할 수 없게 된다.

여기서 범프의 역할이 크다. 살짝 비켜나가게 만들 때 사용되는 값으로 해당 값을 찾아내야만 유효한 PDA 주소가 완성된다.
이렇게 만들어진 PDA를 사용하면, 개인 키를 사용할 필요가 없어진다. 이 PDA를 파생시킨 (Derived) 프로그램만이 이 계좌를 제어할 권한을 갖는다. 프로그램은 개인키 대신, PDA의 주인임을 증명하는 증표(seeds)와 범프(bump)를 가지고 있다.

자판기 프로그램이 거스름돈을 내주기 위해 PDA 계좌의 소유권을 증명하고 서명하는 과정이다.

<div class="mermaid">
sequenceDiagram
    participant P as 자판기 프로그램
    participant N as 솔라나 네트워크
    
    P->>N: ① "이 트랜잭션은 내가 서명하는 게 맞아!"<br/>(거스름돈 전송 명령과 함께)
    Note right of P: 개인키 대신 PDA의<br/>소유권을 증명해야 함
    
    P->>N: ② [증표(seeds) + 범프(bump)] 제출
    
    N->>N: ③ PDA 주소 및 권한 검증
    Note left of N: (프로그램 ID + 증표 + 범프)를 조합하여<br/>PDA 주소가 맞는지, 이 프로그램이<br/>해당 PDA의 주인인지 확인
    
    N-->>P: ④ 서명으로 인정 및 트랜잭션 허가
</div>

## 교차 프로그램 호출 (Cross Program Invocation, CPI)

솔라나 프로그램 안에서 다른 프로그램을 호출하는 방법을 의미한다.
이를 통해 다른 프로그램의 기능을 함수처럼 가져와 사용할 수 있다.

강의에는 이 두가지 개념(PDA와 CPI)이 실제로 어떻게 작동하는지 보여주는 실습 예제가 포함되어 있어, 이론을 코드로 직접 확인할 수 있다.