---
layout: post
title: Chapter 4-1. CAP 정리와 블록체인
categories: web3
tags: [Blockchain]
---
## 초기 분산 네트워크의 등장

CAP 정리와 같은 분산 시스템 이론이 정립되기 전부터, 중앙 통제 없이 작동하는 네트워크에 대한 아이디어는 여러 형태로 구현됐다.

- **ARPANET**: 초기 인터넷의 효시인 ARPANET은 군사적 목적으로, 일부 노드가 파괴되어도 전체 네트워크가 유지되도록 설계됐다. 이는 중앙 서버 없이 데이터를 여러 경로로 전송하는 분산 네트워크 개념의 초기 구현 사례 중 하나다. ARPANET의 설계 철학은 분할 내성(Partition Tolerance)과 가용성(Availability)의 중요성을 보여주며 ==훗날 CAP 정리의 이론적 토대를 마련했다.[^1]==

- **유즈넷 (Usenet)**: 1980년에 등장한 세계적인 분산 토론 시스템이다. 중앙 서버 없이, 전 세계 서버들이 서로 메시지를 주고받는 '플러딩(flooding)' 방식으로 운영됐다. 각 서버 관리자가 독립적으로 연결할 다른 서버와 수신할 뉴스 그룹을 결정하는 구조로, 매우 ==탈중앙화된 초기 소셜 네트워크로 볼 수 있다.[^2]==

- **피도넷 (FidoNet)**: 1980년대에 유행했던 BBS(개인 컴퓨터 통신 서비스)들을 연결하던 네트워크다. 전 세계 수천 개의 독립적인 BBS가 피도넷을 통해 이메일과 파일을 교환했다. ==전화 접속을 통해 데이터를 저장하고 전달하는(store-and-forward) 방식으로 작동하는 자발적 참여 기반의 분산 네트워크였다.[^3]==

- **P2P (Peer-to-Peer) 네트워크**: 90년대 후반부터 등장한 냅스터(Napster), 비트토렌트(BitTorrent) 등은 이 개념을 대중화시킨 대표적인 사례다. 중앙 서버의 개입 없이 개인 컴퓨터(Peer)들이 직접 연결되어 데이터를 공유하는 방식으로, 오늘날까지도 널리 사용된다.

이러한 초기 네트워크들은 중앙 실패 지점(single point of failure)이 없는 견고한 통신 시스템을 만들려는 시도였으며, 현재 블록체인 기술의 사상적 기반이 되었다.


## CAP 정리의 등장

**CAP 정리**는 분산 시스템 설계의 근본적인 트레이드오프를 설명하는 원칙이다.

CAP 정리에 담긴 분산 데이터베이스 설계 시의 트레이드오프는 **1970년대부터 분산 데이터베이스 설계자들에게 알려져 있었다**.
**2000년 에릭 브루어(Eric Brewer)에 의해 CAP 정리로 명명**되었다. 브루어의 관련 연구는 **1999년**에 처음 발표되기도 했다.
이후 길버트(Gilbert)와 린치(Lynch)에 의해 **2002년**에 정리로 공식화됐다.

• **의미**: CAP 정리는 분산 시스템이 다음 세 가지 속성 중 최대 두 가지만을 동시에 만족시킬 수 있다는 것을 의미한다.
  - **일관성 (Consistency)**: 모든 노드가 동시에 같은 데이터를 보여줘야 한다.
  - **가용성 (Availability)**: 모든 요청에 대해 시스템은 항상 응답해야 한다.
  - **분할 내성 (Partition Tolerance)**: 네트워크에 문제가 생겨 노드 간 통신이 단절되더라도 시스템은 계속 작동해야 한다.

현실의 분산 시스템에서 네트워크 분할(Partition)은 언제든 발생할 수 있는 피할 수 없는 문제다. 따라서 **분할 내성(P)은 기본적으로 만족시켜야 할 필수 조건**이 되었고, 설계자들은 **일관성(C)과 가용성(A) 사이에서 트레이드오프**를 선택하게 된다.

## CAP 활용 사례: CP와 AP 시스템

#### 1. CP 시스템 (일관성 + 분할 내성)
네트워크 분할이 발생했을 때, 데이터의 일관성을 우선시하여 일부 노드의 응답을 중단시키는 시스템이다. 데이터가 틀릴 바에는 차라리 응답하지 않는 것을 선택한다.

- **활용 사례**: 은행의 ATM, 금융 거래 시스템
  - **예시**: 두 개의 데이터 센터(A, B)를 운영하는 은행이 있다고 가정해보자. 네트워크 문제로 A와 B의 연결이 끊겼을 때, A 데이터 센터에 연결된 ATM에서 사용자가 돈을 인출하려 한다. 이때 시스템은 B 데이터 센터의 최신 잔액 정보를 확인할 수 없으므로, 데이터 불일치를 막기 위해 거래를 거부(응답 실패)한다. 가용성은 떨어지지만, 계좌 정보의 일관성은 지킬 수 있다.

#### 2. AP 시스템 (가용성 + 분할 내성)
네트워크 분할이 발생했을 때, 데이터의 일관성이 다소 깨지더라도 모든 요청에 응답하는 것을 우선시하는 시스템이다.

- **활용 사례**: 소셜 미디어 피드, 온라인 쇼핑몰의 장바구니 기능
  - **예시**: 인스타그램이나 페이스북 같은 소셜 미디어는 전 세계에 분산된 서버를 사용한다. 일부 서버에 통신 문제가 생기더라도 사용자는 언제나 피드를 보거나 '좋아요'를 누를 수 있어야 한다. '좋아요' 개수가 실시간으로 정확히 일치하지 않더라도 서비스 자체는 중단 없이 제공되는 것이 더 중요하기 때문이다. 데이터는 나중에 동기화(Eventual Consistency)된다.

## 블록체인과 CAP 정리

블록체인 역시 분산 원장 기술(DLT)을 기반으로 하는 분산 시스템이므로 CAP 정리의 영향을 받는다. CAP 정리를 제안한 에릭 브루어는 나중에 이 정리가 '셋 중 둘'의 문제가 아니라, 네트워크 분할(Partition)이라는 특정 장애 상황에서 어떤 것을 우선할지 선택하는 '절충'의 문제라고 명확히 했다.

- **블록체인의 선택**: 대부분의 블록체인(비트코인, 이더리움 등)은 네트워크 분할 시, **CP(일관성 + 분할 내성) 시스템**으로 작동하도록 설계되었다. 이는 가용성보다 데이터의 일관성을 우선시한다는 의미다.

- **일관성(C)**: 모든 참여자가 동일한 장부(블록체인)를 공유해야 하며, 거래 기록은 위변조될 수 없고 모두에게 동일하게 보여야 한다. 포크(Fork)가 발생하더라도 결국 하나의 정식 체인(Canonical Chain)만 인정되어 일관성을 유지한다.

- **분할 내성(P)**: 블록체인은 전 세계에 흩어진 수많은 노드로 구성되며, 일부 노드가 네트워크에서 분리되더라도 전체 시스템은 계속해서 블록을 생성하고 작동한다.

- **가용성(A)과의 절충**: 블록체인은 가용성을 완전히 '희생'하지 않는다. 대신, 일관성을 보장하기 위해 '즉각적인 응답'을 '최종적인 응답'으로 지연시킨다. 즉, 시스템은 요청에 응답할 수 있지만(Available), 그 응답이 모든 노드에게 동의를 받은 '확정된' 상태가 되기까지는 시간이 걸린다. 이 지연 시간이 바로 블록체인이 일관성을 위해 가용성과 맞바꾸는 절충점이다.

#### 요약
블록체인이 CAP 정리에서 어떤 선택을 하는지 쉽게 풀어쓰면 다음과 같다.

- **'일관성'과 '분할 내성'을 우선한다**: 블록체인의 최우선 목표는 '모든 참여자가 동일한 정보를 보는 것(일관성)'과 '네트워크 일부가 고장 나도 전체는 동작하는 것(분할 내성)'이다.

- **왜 일관성이 중요한가?**: 모든 참여자가 동일한 거래 장부를 공유해야 자산의 신뢰가 보장된다. 특히 비트코인 같은 작업증명(PoW) 방식에서는 합의 과정에서 일시적으로 데이터가 두 갈래(포크)로 나뉠 수 있지만, 결국 모두가 하나의 정답 체인만 인정하고 따라가므로 최종적인 일관성을 유지한다.

- **왜 분할 내성이 중요한가?**: 중앙 서버가 없기 때문에, 전 세계에 흩어진 컴퓨터(노드)들의 연결이 일부 끊어져도 전체 네트워크는 멈추지 않고 계속 작동해야만 탈중앙 시스템으로 존재할 수 있다.

- **가용성(A)은 어떻게 절충되는가?**: 가용성을 완전히 포기하는 것은 아니다. 대신, '즉각적인' 가용성을 '최종적인' 데이터 일관성과 맞바꾼다. 거래가 발생하면 네트워크에 즉시 전파되지만, 이 거래가 모든 노드에게 **'확정(Finality)'** 된 상태로 인정받기까지는 합의 시간이 필요하다. 예를 들어 비트코인은 6개의 블록이 쌓이는 약 1시간을 기다려야 거래가 사실상 뒤집을 수 없는 **내구성(Durability)** 을 갖는다고 본다. 이 **'최종 합의까지의 지연 시간(Latency to Finality)'** 이 바로 블록체인이 일관성을 위해 가용성과 절충하는 지점이다.

[^1]: [Internet Society: Brief History of the Internet](https://www.internetsociety.org/internet/history-internet/brief-history-internet/)
[^2]: [Living Internet: Usenet History](https://www.livinginternet.com/u/ui_history.htm)
[^3]: [Ars Technica: FidoNet](https://arstechnica.com/information-technology/2014/05/fidonet-the-bbs-era-network-thats-still-connecting/)
