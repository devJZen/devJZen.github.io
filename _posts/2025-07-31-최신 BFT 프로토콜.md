---
layout: post
title: Chapter 3-1. 최신 BFT 프로토콜
categories: web3
tags: [CosmosSDK]
---
BFT 프로토콜은 꾸준히 발전되어 왔으며 문제점을 개선하기 위해 다양한 방법론이 제시되었다.

## 1. 최신 BFT 프로토콜 진화 타임라인

```mermaid
flowchart LR
  subgraph "고전 BFT (Classic BFT)"

     A["Byzantine Generals Problem<br><b>(1982)</b>"] --> B["PBFT<br><b>(1999)</b>"];

  end

  subgraph "<b>단일 리더 BFT: 지연시간(Latency) 최적화</b>"

        direction LR

        B -- "블록체인 적용" --> C["Tendermint<br><b>(2014)</b>"];

        C -- "코어 개선/포크" --> D["CometBFT<br><b>(2023)</b>"];

        B -- "리더 교체 최적화" --> E["HotStuff<br><b>(2018)</b><br>(e.g., Aptos)"];

        E -- "낙관적 응답성 추가" --> J["Fast-HotStuff<br><b>(2020)</b>"];

  end

  subgraph "<b>DAG 기반 BFT: 처리량(Throughput) 극대화</b>"

        direction LR

        P["<b>패러다임 전환</b><br>Mempool(데이터 전파)과<br>Consensus(순서 합의) 분리<br>(e.g.,

Sui)"]

        P -- "Narwhal (Mempool)<br>+ Tusk (Consensus)" --> G["Narwhal & Tusk<br><b>(2021)</b>"];

        P -- "Narwhal (Mempool)<br>+ Bullshark (Consensus)" --> H["Bullshark<br><b>(2022)</b>"];

        P -- "DAG 기반 합의" --> I["DAG-Rider<br><b>(2021)</b>"];

        P -- "DAG 기반 합의" --> K["Malachite<br><b>(2021)</b>"];

        P -- "네트워크 적응형 DAG" --> L["Autobahn<br><b>(2023)</b>"];

  end

E -- "<b>처리량 한계 극복 시도</b>" --> P;
```

- BFT는 지연시간 최적화와 처리량 극대화를 개선하기 위해 발전하고 있다.
- CometBFT도 DAG 기반의 프로토콜로 변화하려고 하고 있다.

## 2. DAG 기반 합의로의 CometBFT 변화

- Cosmos SDK 기반에서 DAG 프로토콜의 장점을 접목 시켜 병목 현상을 해결할 수 있는가에 대한 연구 : [# Cosmos without Tendermint: Exploring Narwhal and Bullshark](https://www.paradigm.xyz/2022/07/experiment-narwhal-bullshark-cosmos-stack)

## 3. 단일 리더 합의와 DAG 기반 합의의 비교

전통적인 블록체인 합의 프로토콜은 대부분 단일 리더(Single-Leader) 방식을 채택해왔다. 이 방식은 구조적으로 명확하지만 처리량에 한계가 있어, 이를 극복하기 위한 대안으로 DAG(Directed Acyclic Graph) 기반 합의 방식이 주목받고 있다.

### 단일 리더 합의 방식과 그 한계

Tendermint, HotStuff과 같은 기존 프로토콜은 특정 라운드(또는 view)마다 하나의 노드가 '리더'로 선정되어 합의를 주도한다.

동작 방식
1. **리더 선출:** 정해진 규칙에 따라 리더 노드가 선정된다.
2. **블록 제안:** 리더는 트랜잭션들을 모아 블록으로 만든 후, 다른 모든 노드에게 이 블록으로 합의하자고 제안한다.
3. **합의 체결:** 다른 노드들은 제안받은 블록을 검증하고 투표하여 합의를 완료한다.

한계점
- **병목 현상:** 모든 트랜잭션이 리더 노드로 집중되므로, 리더의 처리 성능이 전체 시스템의 처리량을 결정한다.
- **순차적 처리:** 한 번에 하나의 블록 제안만 처리할 수 있어 작업이 순차적으로 진행될 수밖에 없다.

### 대안으로서의 DAG 기반 합의

DAG 기반 합의는 단일 리더의 병목을 제거하기 위해 **데이터 전파**와 **순서 결정**이라는 두 가지 작업을 분리하는 접근법을 사용한다. 대표적으로 **Narwhal & Tusk** 프로토콜이 이 구조를 따른다.

**1단계: 데이터 전파 (Narwhal - DAG 기반 Mempool)**
-  리더 없이 모든 노드가 자신이 받은 트랜잭션을 다른 노드들에게 동시에 브로드캐스팅한다.
- 트랜잭션(또는 트랜잭션 묶음)들은 인과관계를 가지며 DAG 형태로 모든 노드에게 공유된다.
- 이 단계의 목표는 **모든 노드가 합의에 필요한 데이터를 빠짐없이 갖도록 하는 것**이며, 작업이 병렬로 처리되어 매우 높은 처리량을 달성할 수 있다.

**2단계: 순서 결정 (Tusk - Consensus)**
-  모든 노드가 동일한 DAG를 공유하게 되면, 이 DAG 구조 위에서 가벼운 합의 프로토콜을 실행하여 **트랜잭션의 최종 순서를 확정**한다.
- 데이터를 주고받는 무거운 작업이 1단계에서 이미 완료되었기 때문에, 순서만 정하는 과정은 매우 빠르고 효율적으로 진행된다.

이처럼 작업을 분리함으로써 DAG 기반 합의는 단일 리더 방식의 한계를 극복하고 높은 처리량과 분산성을 동시에 달성할 수 있다.

## 4. Autobhan

기존 BFT 프로토콜의 hangover 문제를 해결한 프로토콜로써 최신 연구에 속한다.
- 기존 BFT 프로토콜들은 '좋은 구간(good intervals)'(네트워크가 동기화되고 합의 과정이 올바른 복제본에 의해 주도되는 기간)에서는 낮은 지연 시간을 제공하지만, '블립(blips)'(진행을 방해하는 이벤트 발생 시) 발생 시 성능 저하(행오버)를 겪을 수 있다. 이 행오버는 좋은 구간으로 복귀한 후에도 지속될 수 있다.
- 현대의 DAG(Directed Acyclic Graph) 기반 BFT 프로토콜은 블립으로부터 더 부드럽게 복구되지만, 좋은 구간에서의 지연 시간이 길다는 단점이 있었다.
- Autobahn은 이러한 절충점을 해결하여, 행오버를 최소화하면서도 동기 기간 동안 낮은 지연 시간을 유지하는 새로운 합의 프로토콜이다. '끊김 없는(seamless)'이란, 합의가 블립에 더 취약해지지 않으면서도 블립에서 복귀했을 때 밀린 데이터를 즉시 커밋할 수 있다는 것을 의미한다.
