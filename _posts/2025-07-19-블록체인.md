---
layout: post
title: Chapter 1-1. 블록체인
categories: web3
tags: [Blockchain]
---
> **블록체인**은 **분산된 합의 기반 트랜잭션 시스템의 근간을 형성하는 모델**이다.

블록체인의 역사는 1990년대 물리학자인 스튜어트 하버와 W. 스콧 스토네타가 어떻게 과거를 안전하게 지키고 디지털 정보를 안전하게 보호하고 변조를 방지할 수 있을지에 대한 고민으로 시작됐다.

사토시 나카모토가 2008년에 '비트코인: P2P 전자 화폐 시스템'이라는 논문을 발표하며 블록체인 기술이 상용화 되었다. 이 논문은 오늘날 가장 일반적으로 알려진 비트코인을 기술적으로 정의한 논문이다. 그래서 사람들이 비트코인을 블록체인 그 자체라고 오해하는 경우도 있다. 하지만 블록체인은 분산된 정보를 저장하는 기술이다. 2014년, 이더리움이 발표되었으며 이더리움은 EVM을 통해 혁신을 이뤘다.

[블록체인 ≠ 비트코인] 이 가장 중요한 개념이며, 암호화폐는 블록체인 기술로 구현된 것 뿐이다.

## 1. 블록체인

블록(데이터)들을 **P2P 방식(분산 방식)** 으로 체인 형태의 분산 데이터 저장 환경에 저장한 것을 블록체인이라고 부른다. 분산 시스템 모델이라고 봐도 좋다.

- 블록체인은 데이터의 무결성과 불변성을 보장하기 위해 **블록마다 해시 값을 저장**한다.

  - 쉽게 설명하면 해시 데이터는 제품의 로트넘버, 인체의 지문 등등 과 같은 고유한 값이다.
  - 해시 데이터는 동일한 데이터 생성이 매우 어렵도록 설계 되어있고 해시 충돌은 사실상 불가능에 가깝다. 이런 특성으로 인하여 불변성을 가진다.
  - 암호학적 연결은 분산 시스템에서 **정보의 신뢰성, 무결성, 가용성을 보장**하는 역할을 한다.
  - 이더리움의 세계 상태(world state)는 Merkle patricia 트리를 통해 관리되며, 이 트리의 루트 해시는 모든 내부 데이터에 암호학적으로 의존한다. 이는 상태의 보안 ID 역할을 하며, 불변성을 통해 이전 상태로 쉽게 돌아갈 수 있게 합니다.
- 블록체인 마다 다른 해시 암호화 기술을 채택하는 경우

  - 비트코인은 SHA-256을 사용하고 이더리움은 Keccak-256을 사용한다.
  - Keccak-256은 SHA-3 암호화 대회 최종 우승 알고리즘이었으며, FIPS 202로 표준화 되었지만 원래의 Keccak-256를 사용한다. 이 둘은 패딩 매개변수에서 미묘한 구현 차이로 인해 다른 해시 값을 생성한다.
  - EVM(이더리움 가상 머신)의 256비트워드 크기와 스택 항목 크기는 Keccack-256 해시 체계와 타원 곡선 연산을 위해 선택되었다.
- 분산 시스템의 개방성(openness)과 관리적 확장성(administrative scalability)

| 참여 및 접근 권한     | 허가 여부(Permission)          | 합의(Consensus)      | 설명                                                                                                                               |
| --------------------- | ------------------------------ | -------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| 공개 (Public)         | 허가 필요 없음(Permissionless) | PoW, PoS             | 비트코인, 이더리움과 같은 공개형 모델들이 해당되며 특정 권한이나 허가 없이 모든 활동이 가능하다.                                   |
| 비공개 (Private)      | 허가 필요함(Permissioned)      | PoS, PoA             | Rinkeby는 블록이 신뢰할 수 있는 서명자에 의해서만 채굴되는 권한 증명 방식을 사용하는데, 신뢰할 수 있는 참여자들만 활동이 가능하다. |
| 컨소시엄 (Consortium) | 상황에 따라서 허가 필요함      | 공동의 의사결정 구조 | 컨소시엄 내의 참여 조직들이 공동으로 합의 메커니즘을 운영한다. 공동의 의사결정 구조를 가진다.                                      |

블록체인은 공개형으로 시작되었다. 기업과 기관들이 블록체인 기술을 도입하려 하면서 그들의 운영 방식과 거버넌스의 필요성에 따라서 '비공개'와 '컨소시엄'같은 모델들이 등장하게 되었다.

마스터링 이더리움에서는 "모든 블록체인이 똑같이 생성되지 않았다." 어떤 블록체인인지 이해하려면 개방형(open), 공개형(public), 전역형(global), 분산형(decentralized), 중립적(neutral), 검열 저항적(censorship-resistant) 같은 개방성과 관리적 확장성의 특성들을 명확히 해야 한다고 했다.

## 2. 블록과 노드, 트랜잭션

블록은 데이터의 단위(실질적인 데이터는 아니다.), 노드는 합의에 참여하는 사용자, 트랜잭션은 블록 상태 변경의 기본 단위를 의미한다.

> 블록은 트랜잭션을 포함하고, 이 트랜잭션들을 순차적으로 실행하여 상태를 변경한다.

이더리움에서의 트랜잭션은 상태 변화를 유발하는 '서명된 메시지'다. 예를 들어서, 한 계정이 다른 계정으로 이더를 전송하는 내용을 담을 수도 있고, 웹으로 생각하면 포스팅의 내용을 포함한다거나, 스마트 컨트랙트를 생성하거나, 스마트 컨트랙트의 함수를 호출하는 행위들이 모두 트랜잭션에 해당한다.

이더리움 옐로우 페이퍼에 따르면, 트랜잭션 `T`가 현재 상태 `σ`에서 실행되면, **새로운 상태 σ′를 생성**한다. 이는 `σ′ = Υ(σ, T)`로 형식적으로 정의된다. 여기서 `Υ`는 트랜잭션 평가 함수가 된다.

### 트랜잭션(Transactions)

- ACID의 속성을 지녔다.
- 원자성(Atomicity), 일관성(Consistency), 고립성(Isolation), 내구성(Durability)을 의미한다.
  - 원자성: 트랜잭션이 성공적으로 완료되거나 상태에 전혀 영향을 미치지 않고 완전히 되돌려진다는 것을(reverted) 의미한다.
    - 실행 오류로 실패한다면 모든 상태 변경(변수, 잔액 등)은 트랜잭션이 실행되지 않은 것처럼 '롤백'된다.
    - 실패한 트랜잭션은 시도된 것으로 기록되고 가스 비용은 발신 계정에서 공제되지만 계약이나 계정 상태에는 영향이 없다.
  - 일관성: 이더리움은 전체적으로 트랜잭션 기반의 상태 기계로 볼 수 있다. 제네시스 상태에서 시작하여 점진적으로 현재 상태로 변화시킨다. '현재' 상태가 이더리움 세계의 '정식'버전으로 간주된다.
    - 트랜잭션은 두 상태 간의 '유효한 전환점'을 말한다. 유효한 상태 전환은 트랜잭션을 통해서 발생한다는 것은 일관성을 보장한다.
  - 고립성: 트랜잭션 실행 실패 시 모든 상태 변경이 롤백되는 것은 트랜잭션이 완료되지 않으면 중간 상태가 영구적으로 반영되지 않도록 하여 어느 정도의 고립성을 보장한다.
    - Cryptlets가 ACID 방식으로 분산 트랜잭션을 지원하여 사적인 진실 해상도를 가능하게 한다는 것은 다른 동시 트랜잭션으로부터의 영향을 제한하는 고립성의 개념을 의미한다.
  - 지속성: 초기화 코드가 성공적으로 완료되면, 변경된 상태가 지속되도록 허용된다. 이는 트랜잭션이 성공적으로 실행된 후의 상태 변경이 영구적임을 나타낸다.
- 스냅샷 격리(Snapshot Isolation)는 트랜잭션이 데이터베이스의 일관된 스냅샷에서 읽도록 보장하며, MySQL과 PostgreSQL의 반복 읽기와 동일하다.
- 필수 구성 요소: nonce, gasPrice, gasLimit, to, value, data(input), Signature
- 트랜잭션을 실행하려면 Gas가 필요하다.
  - Gas의 주요 역할은 자원 측정 및 제한, DoS 공격 방지, 경제적 인센티브, 우선순위 결정이다.

합의에 대해서 정리하지 못해서 내일 당장 수정해야할 것 같다. 트랜잭션의 개념을 먼저 파고들었는데 합의와 합의 알고리즘, 합의 매커니즘에 대해서 이해하고 나면 더 쉽게 이해할 수 있었을 것 같다.

## 3. 합의 알고리즘과 매커니즘

> 합의 매커니즘이 합의 알고리즘을 포괄하는 개념이다.

두 단어가 혼용되는 경우가 많다. 단어의 경계가 유동적이지만 핵심은 여러 노드가 오류가 발생하더라도 어떤 값에 대해 동일하도록 보장하는 것이다. 더 쉽게 얘기하면 합의 알고리즘은 요리법(알리오올리오 레시피)과 같고 매커니즘은 요리 스타일(이탈리안 스타일)과 같다.

**합의 알고리즘(Consensus Algorithm)** 은 합의를 달성하기 위한 구체적인 절차와 규칙의 집합을 의미한다. 이는 '수학적으로 정의된 단계와 프로토콜'을 포함한다.
	- 텐더민트(Tendermint), 나라왈/불샤크(Narwhal/Bullshark), 핫스터프(HotStuff), 팍소스(Paxos), PBFT(Practical Byzntine Fault Tolerance)가 여기에 해당된다.
**합의 매커니즘(Consensus Mechanism)** 은 합의를 달성하기까지 사용되는 광범위한 원칙, 시스템, 또는 접근 방식을 지칭하는 경향이 있다. 알고리즘 뿐만아니라 기본적인 동기 부여, 인센티브, 자원 제어 방법을 포함할 수 있다.
	- PoW과 PoS는 블록체인에서 합의를 달성하는 매커니즘으로 설명된다. 이러한 매커니즘을 통해 노드들이 합의에 참여하도록 유도한다.
	- 이더리움의 Gas 또한 네트워크의 자원 남용을 방지하여 합의의 안정적인 달성을 지원하는 제어 매커니즘의 역할을 한다.

## 4. 구현 사례

- 비트코인
- 이더리움
- 코스모스
- 솔라나
- etc..

> **Layer 1 blockchain?**
> Layer 1은 데이터 계층, 기본 블록체인을 의미한다. 거래를 확인하고 실행하는 블록체인이다. 구현사례에 해당되는 블록체인은 전부 Layer 1에 속한다.
> Layer 2는 Layer 1 블록체인을 사용하거나 이를 위해 작동하는 모든 오픈체인 네트워크, 시스템 또는 기술, 기본 레이어 네트워크의 기능을 의미한다.
> Layer 3는 Layer 1, 2를 바탕으로 DApp에 대한 향상된 확장성, 상호 운용성 및 특수 기능을 제공한다.
